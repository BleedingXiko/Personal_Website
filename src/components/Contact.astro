<form id="contactForm">
    <input type="text" id="name" placeholder="Your Name">
    <input type="email" id="email" placeholder="Your Email">
    <textarea id="message" placeholder="Your Message"></textarea>
    <button type="button" id="submitBtn">Submit</button>
    <div id="successMessage" style="display: none;"></div>
</form>

<script>
    document.addEventListener('astro:after-swap', () => {
        $('#submitBtn').on("click", function (e) {
            e.preventDefault();

            // Get the values from the form
            const name = $('#name').val();
            const email = $('#email').val();
            const message = $('#message').val();

            // Remove previous validation highlighting
            $('#name, #email, #message').removeClass("error");

            // Validate the input fields
            if (name.trim() === "") {
                $('#name').addClass("error");
            }
            if (email.trim() === "") {
                $('#email').addClass("error");
            }
            if (message.trim() === "") {
                $('#message').addClass("error");
            }

            // Validate the email format using a regex
            const emailRegex = /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i;
            if (!email.match(emailRegex)) {
                $('#email').addClass("error");
            }

            // Check if any input fields have the "error" class
            if ($('#contactForm .error').length > 0) {
                // Highlight invalid fields and prevent form submission
                return;
            }

            const formData = {
                name: name,
                email: email,
                message: message,
            };
            const formDataJSON = JSON.stringify(formData);

            // Clear the form fields
            $('#name').val('');
            $('#email').val('');
            $('#message').val('');

            // Set the success message
            const successMessage = "Form submitted successfully! JSON Data: " + formDataJSON;

            // Display the success message
            $('#successMessage').text(successMessage).show();

            // Set a timer to hide the success message after 5 seconds
            setTimeout(function () {
                $('#successMessage').fadeOut();
            }, 5000);
        });
    });


    // astro workaround for page load and swap
    $(function() {
           $('#submitBtn').on("click", function (e) {
            e.preventDefault();

            // Get the values from the form
            const name = $('#name').val();
            const email = $('#email').val();
            const message = $('#message').val();

            // Remove previous validation highlighting
            $('#name, #email, #message').removeClass("error");

            // Validate the input fields
            if (name.trim() === "") {
                $('#name').addClass("error");
            }
            if (email.trim() === "") {
                $('#email').addClass("error");
            }
            if (message.trim() === "") {
                $('#message').addClass("error");
            }

            // Validate the email format using a regex
            const emailRegex = /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i;
            if (!email.match(emailRegex)) {
                $('#email').addClass("error");
            }

            // Check if any input fields have the "error" class
            if ($('#contactForm .error').length > 0) {
                // Highlight invalid fields and prevent form submission
                return;
            }

            const formData = {
                name: name,
                email: email,
                message: message,
            };
            const formDataJSON = JSON.stringify(formData);

            // Clear the form fields
            $('#name').val('');
            $('#email').val('');
            $('#message').val('');

            // Set the success message
            const successMessage = "Form submitted successfully! JSON Data: " + formDataJSON;

            // Display the success message
            $('#successMessage').text(successMessage).show();

            // Set a timer to hide the success message after 5 seconds
            setTimeout(function () {
                $('#successMessage').fadeOut();
            }, 5000);
        });
    });
</script>


<style>
   #contactForm .error {
        border: 2px solid red;
    }

        form {
            max-width: 400px;
            margin: 15px auto;
            background-color: var(--comp);
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }

        label, input, textarea {
            display: block;
            margin-bottom: 10px;
        }

        input[type="text"],
        input[type="email"],
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--fg);
            border-radius: 5px;
            color: rgb(0, 0, 0);
        }

        button {
            background-color: var(--fg);
            color: var(--comp);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }

        #successMessage {
            display: none;
            background-color: var(--bg_comp);
            color: var(--comp);
            overflow: auto;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
        }
</style>
